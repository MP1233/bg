<h1>Bio-calculator. Calculation algorythms using neocortex neurons.</h1>


 human cortex is 6 layered structure with primary and interneuron types studied. many of such types of neurons are already modelled in neuroML
 one of examples of tasks that human brain can perform - summing or substracting 2 values. although it is clear that such calculations are more complex and widespread across different areas of the brain, that the purpose of this work is to implement a microcircuit for simple calculations using already existing models of neocortex neurons to see how such microcircuit will appear in 3D. also to adjust such microcircuit to known charateristics of 6 layered structure, such as synapses and cell types density in the layers<br>
 although non of the microcircuits is non supposed to work as a math calculator, it is quite possible that it can use some of similar algorythms for some of its calculations. the purpose is to approximize how well can such type of algorythm fit the cortex 6 layered structure<br>

also this work can be used as practical experience with different neuroML type simulators. and adjusting synaptic properties task

<br><br>
current architecture simply activates "summ neuron" when two "value neurons" start firing. however further work planned on context of "+" "-" "1st value" vs "second value" and "=" command. context signals probably be transferred via 1st layer
<br><br>














<h3>(A + B) , (A - B) implementation</h3>

For brevity let A have only n=4 values - 0,1,2,3 and B also have m=4 values - 0,1,2,3. Thus number of neurons needed for this input will be m+n = 8 Simple structure of code for such implementation will look like<br>
<br>
if Operation==PLUS {Operation=PLUS}<br>
if Operation==MINUS {Operation=MINUS}<br>
#2 neurons<br>
<br>
if input1==0 {Component1=0}<br>
if input1==1 {Component1=1}<br>
if input1==2 {Component1=2}<br>
if input1==3 {Component1=3}<br>
if input2==0 {Component2=0}<br>
if input2==1 {Component2=1}<br>
if input2==2 {Component2=2}<br>
if input2==3 {Component2=3}<br>
#8 neudons<br>
<br>
if (Component1==0 , Component2==0, Operation==+) {Output = [0+0]}<br>
if (Component1==0 , Component2==1, Operation==+) {Output = [0+1]}<br>
if (Component1==0 , Component2==2, Operation==+) {Output = [0+2]}<br>
if (Component1==0 , Component2==3, Operation==+) {Output = [0+3]}<br>
if (Component1==1 , Component2==0, Operation==+) {Output = [1+0]}<br>
<br>
...<br>
if (Component1==3 , Component2==3, Operation==-) {Output = [3-3]}<br>
#32 neurons<br>
<br>
<br>
if Output==[0+0] {Result=0}<br>
if Output==[0+1] {Result=1}<br>
if Output==[0+2] {Result=2}<br>
...<br>
if Output==[3-3] {Result=0}<br>
#result space[-3..6] 10 neurons<br>
<br>
<br>
<br>
<br>
for + operator we will need space of m*n=16 neurons. also 16 neurons for - operator. alltogether 32 neurons. result of such operation will occupy range [-3..6] 10 neurons. This algorythm can be implemented with excitory neurons (see App1).<br>
 click on operation_input, input1 & input2 neurons several times to start input firing and see which output neurons will fire<br>

<br>
<input type="button" id="Axon_OscPLUS" value="PLUS" >
<input type="button" id="Axon_OscMINUS" value="MINUS" >
<input type="button" id="Axon_Osc1_0" value="Component1_0" >
<input type="button" id="Axon_Osc1_1" value="Component1_1" >
<input type="button" id="Axon_Osc1_2" value="Component1_2" >
<input type="button" id="Axon_Osc1_3" value="Component1_3" >
<input type="button" id="Axon_Osc2_0" value="Component2_0" >
<input type="button" id="Axon_Osc2_1" value="Component2_1" >
<input type="button" id="Axon_Osc2_2" value="Component2_2" >
<input type="button" id="Axon_Osc2_3" value="Component2_3" >



<br>
<canvas id="canvas" width=1200 height=1300></canvas>
<br>
App1<br><br><br>


A<img src="Neuroml_img/tut2_raster_gid.png"><br>B<img src="Neuroml_img/tut2_traces__gid_10_.png"><br>
Fig 2 Netpyne output for Input: Component1=0, Component2=0, Operation=PLUS. A all neurons, B Output0+0 neuron<br><br><br>




It is possible to see that neuron that gives us correct answer fires the most, however other output neurons also fire. In computer code "if" statement prevents all other conditions. However in our network preventing all other actions is not that trivial. Thus we need to filter incorrect neurons using inhibitory neurons. <br><br><br>


<a href="test_neuroML2.html">PAGE 2</a>

<br><br><br><br>
Filtering usually is done using feedback and feedforward inhibition. (Fig 3). Feedforward inhibition usually used to enhance simultaneous inputs and filter asynchroneus inputs. Feedback used to select most active networks and suppress other networks. Hence our task will demand feedback inhibiton. Results of such inhibition filter aoolied can be tested on (App 4)





App4


Such algorythm was applied to NeuroML Netpyne with simplified neurons that have not natural parameters such as 1.0 firing probability. (Fig 4). code /tut2new.py

Fig 4





<h3>context implementation. complex equations solutions. for example A+B-C+D=</h3>




<h3>fitting 6 layers</h3>

Lets start with these 2 approximations of 6layers microcircuit and try to fit our network to this scheme. layer4 input+ amplification. Layer 3+2 processing. (Fig) Ascending / descending (Fig)


<h3>fitting existing cortex neuron models</h3>

at this stage lets take existing neuroML models of cortex neurons and synapses and reimplement our model replacing model neurons with real ones<br><br>



at the beginning or "=" command input of input_number_cell 0..9 oscillates 1st_component_cell 0..9
after"-" or "+" command input of input_number_cell 0..9 oscillates 2nd_component_cell 0..9. operation_cell +..- also oscilates
after "=" command > [operation_cell,1st,2nd] activate result cell





















































<script>



GREEN_shiftXY=[100,0]
GREEN2_shiftXY=[400,20]
GREEN3_shiftXY=[570,580]
GREEN4_shiftXY=[800,1000]





    funccolors = {appetite:"#00ffff",
    food:"#00dddd",
    taste:"#00cccc",
breathing:"#00bbbb",
breath:"#00bbbb",
attention:"#00ffdd",
limbic:"#00ff99",

emotion:"#00ffbb",
hearing:"#ff0000",
whiskers:"#dd0000",
sniffing:"#bb0000",



//1 - learning , motor

learning:"#00ff00",
motor:"#00bb00",
behavior:"#00dd00",

//2 - control of head and eye movements

orientation:"#0000bb",
oculomotor:"#0000dd",
visual:"#0000ff",


//3 - stance and locomotion

locomotion:"#ffff00",
posture:"#dddd00",
proprioceptive:"#bbbb00",


//4 - somatosensory reflexes

somatosensory:"#ff00ff",
sensory:"#dd00dd",
sensory_hindlimb:"#bb00bb",
sensory_forelimb:"#990099",
pain:"#770077",
reflexes:"#550055",
arousal:"#330033",
sensory_proprioceptive:"#110011",
temperature:"#220022",
touch:"#440044",
sensory_lips:"#660066",
sensory_head:"#880088",
flexor_reflex:"#aa00aa",

//5 - optokinetic and vestibulo-ocular reflexes

//orientation:"#777777",
vestibular:"#999999",
balance:"#777777",
///visual:"#bbbbbb",



/////////

peptides:"#000000",
}





var AXONS = {

///////////////////////////////////
///GREEN

///Axon_Stellate_A_FL_TO_PRKJ_A_FL:{start_node:"Stellate_A_FL", end_node:"PRKJ_A_FL", shape:[[GREEN_shiftXY[0]+PRKJ_shiftXY[0]+CBCTX_shiftXY[0]-10,GREEN_shiftXY[1]+Stellate_shiftXY[1]+CBCTX_shiftXY[1]+0],[GREEN_shiftXY[0]+PRKJ_shiftXY[0]+CBCTX_shiftXY[0]+0,GREEN_shiftXY[1]+Stellate_shiftXY[1]+CBCTX_shiftXY[1]-10],], type:"GABA", lengthsec:10,power:-1},


///Axon_Parallel_Fiber_spinal_TO_Parallel_Fiber_Granule:{start_node:"Parallel_Fiber_spinal", end_node:"Parallel_Fiber_Granule", shape:[], type:"glutamate", lengthsec:10,power:1},


Axon_OscPLUS:{start_node:"Operator_PLUS", end_node:"Operator_PLUS", shape:["loop"], type:"glutamate", lengthsec:10,power:10},
Axon_OscMINUS:{start_node:"Operator_MINUS", end_node:"Operator_MINUS", shape:["loop"], type:"glutamate", lengthsec:10,power:10},
Axon_Osc1_0:{start_node:"Component1_0", end_node:"Component1_0", shape:["loop"], type:"glutamate", lengthsec:10,power:10},
Axon_Osc1_1:{start_node:"Component1_1", end_node:"Component1_1", shape:["loop"], type:"glutamate", lengthsec:10,power:10},
Axon_Osc1_2:{start_node:"Component1_2", end_node:"Component1_2", shape:["loop"], type:"glutamate", lengthsec:10,power:10},
Axon_Osc1_3:{start_node:"Component1_3", end_node:"Component1_3", shape:["loop"], type:"glutamate", lengthsec:10,power:10},
Axon_Osc2_0:{start_node:"Component2_0", end_node:"Component2_0", shape:["loop"], type:"glutamate", lengthsec:10,power:10},
Axon_Osc2_1:{start_node:"Component2_1", end_node:"Component2_1", shape:["loop"], type:"glutamate", lengthsec:10,power:10},
Axon_Osc2_2:{start_node:"Component2_2", end_node:"Component2_2", shape:["loop"], type:"glutamate", lengthsec:10,power:10},
Axon_Osc2_3:{start_node:"Component2_3", end_node:"Component2_3", shape:["loop"], type:"glutamate", lengthsec:10,power:10},


Axon_1_0plus0:{start_node:"Component1_0", end_node:"Output_0PLUS0", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_0plus0:{start_node:"Component2_0", end_node:"Output_0PLUS0", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_PLUS_0plus0:{start_node:"Operator_PLUS", end_node:"Output_0PLUS0", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_0plus0:{start_node:"Output_0PLUS0", end_node:"RESULT_0", shape:["default"], type:"glutamate", lengthsec:10,power:5},

Axon_1_0plus1:{start_node:"Component1_0", end_node:"Output_0PLUS1", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_0plus1:{start_node:"Component2_1", end_node:"Output_0PLUS1", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_PLUS_0plus1:{start_node:"Operator_PLUS", end_node:"Output_0PLUS1", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_0plus1:{start_node:"Output_0PLUS1", end_node:"RESULT_1", shape:["default"], type:"glutamate", lengthsec:10,power:5},

Axon_1_0plus2:{start_node:"Component1_0", end_node:"Output_0PLUS2", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_0plus2:{start_node:"Component2_2", end_node:"Output_0PLUS2", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_PLUS_0plus2:{start_node:"Operator_PLUS", end_node:"Output_0PLUS2", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_0plus2:{start_node:"Output_0PLUS2", end_node:"RESULT_2", shape:["default"], type:"glutamate", lengthsec:10,power:5},

Axon_1_0plus3:{start_node:"Component1_0", end_node:"Output_0PLUS3", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_0plus3:{start_node:"Component2_3", end_node:"Output_0PLUS3", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_PLUS_0plus3:{start_node:"Operator_PLUS", end_node:"Output_0PLUS3", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_0plus3:{start_node:"Output_0PLUS3", end_node:"RESULT_3", shape:["default"], type:"glutamate", lengthsec:10,power:5},


Axon_1_1plus0:{start_node:"Component1_1", end_node:"Output_1PLUS0", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_1plus0:{start_node:"Component2_0", end_node:"Output_1PLUS0", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_PLUS_1plus0:{start_node:"Operator_PLUS", end_node:"Output_1PLUS0", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_1plus0:{start_node:"Output_1PLUS0", end_node:"RESULT_1", shape:["default"], type:"glutamate", lengthsec:10,power:5},

Axon_1_1plus1:{start_node:"Component1_1", end_node:"Output_1PLUS1", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_1plus1:{start_node:"Component2_1", end_node:"Output_1PLUS1", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_PLUS_1plus1:{start_node:"Operator_PLUS", end_node:"Output_1PLUS1", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_1plus1:{start_node:"Output_1PLUS1", end_node:"RESULT_2", shape:["default"], type:"glutamate", lengthsec:10,power:5},

Axon_1_1plus2:{start_node:"Component1_1", end_node:"Output_1PLUS2", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_1plus2:{start_node:"Component2_2", end_node:"Output_1PLUS2", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_PLUS_1plus2:{start_node:"Operator_PLUS", end_node:"Output_1PLUS2", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_1plus2:{start_node:"Output_1PLUS2", end_node:"RESULT_3", shape:["default"], type:"glutamate", lengthsec:10,power:5},

Axon_1_1plus3:{start_node:"Component1_1", end_node:"Output_1PLUS3", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_1plus3:{start_node:"Component2_3", end_node:"Output_1PLUS3", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_PLUS_1plus3:{start_node:"Operator_PLUS", end_node:"Output_1PLUS3", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_1plus3:{start_node:"Output_1PLUS3", end_node:"RESULT_4", shape:["default"], type:"glutamate", lengthsec:10,power:5},


Axon_1_2plus0:{start_node:"Component1_2", end_node:"Output_2PLUS0", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_2plus0:{start_node:"Component2_0", end_node:"Output_2PLUS0", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_PLUS_2plus0:{start_node:"Operator_PLUS", end_node:"Output_2PLUS0", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2plus0:{start_node:"Output_2PLUS0", end_node:"RESULT_2", shape:["default"], type:"glutamate", lengthsec:10,power:5},

Axon_1_2plus1:{start_node:"Component1_2", end_node:"Output_2PLUS1", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_2plus1:{start_node:"Component2_1", end_node:"Output_2PLUS1", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_PLUS_2plus1:{start_node:"Operator_PLUS", end_node:"Output_2PLUS1", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2plus1:{start_node:"Output_2PLUS1", end_node:"RESULT_3", shape:["default"], type:"glutamate", lengthsec:10,power:5},

Axon_1_2plus2:{start_node:"Component1_2", end_node:"Output_2PLUS2", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_2plus2:{start_node:"Component2_2", end_node:"Output_2PLUS2", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_PLUS_2plus2:{start_node:"Operator_PLUS", end_node:"Output_2PLUS2", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2plus2:{start_node:"Output_2PLUS2", end_node:"RESULT_4", shape:["default"], type:"glutamate", lengthsec:10,power:5},

Axon_1_2plus3:{start_node:"Component1_2", end_node:"Output_2PLUS3", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_2plus3:{start_node:"Component2_3", end_node:"Output_2PLUS3", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_PLUS_2plus3:{start_node:"Operator_PLUS", end_node:"Output_2PLUS3", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2plus3:{start_node:"Output_2PLUS3", end_node:"RESULT_5", shape:["default"], type:"glutamate", lengthsec:10,power:5},





Axon_1_3plus0:{start_node:"Component1_3", end_node:"Output_3PLUS0", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_3plus0:{start_node:"Component2_0", end_node:"Output_3PLUS0", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_PLUS_3plus0:{start_node:"Operator_PLUS", end_node:"Output_3PLUS0", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_3plus0:{start_node:"Output_3PLUS0", end_node:"RESULT_3", shape:["default"], type:"glutamate", lengthsec:10,power:5},

Axon_1_3plus1:{start_node:"Component1_3", end_node:"Output_3PLUS1", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_3plus1:{start_node:"Component2_1", end_node:"Output_3PLUS1", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_PLUS_3plus1:{start_node:"Operator_PLUS", end_node:"Output_3PLUS1", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_3plus1:{start_node:"Output_3PLUS1", end_node:"RESULT_4", shape:["default"], type:"glutamate", lengthsec:10,power:5},

Axon_1_3plus2:{start_node:"Component1_3", end_node:"Output_3PLUS2", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_3plus2:{start_node:"Component2_2", end_node:"Output_3PLUS2", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_PLUS_3plus2:{start_node:"Operator_PLUS", end_node:"Output_3PLUS2", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_3plus2:{start_node:"Output_3PLUS2", end_node:"RESULT_5", shape:["default"], type:"glutamate", lengthsec:10,power:5},

Axon_1_3plus3:{start_node:"Component1_3", end_node:"Output_3PLUS3", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_3plus3:{start_node:"Component2_3", end_node:"Output_3PLUS3", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_PLUS_3plus3:{start_node:"Operator_PLUS", end_node:"Output_3PLUS3", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_3plus3:{start_node:"Output_3PLUS3", end_node:"RESULT_6", shape:["default"], type:"glutamate", lengthsec:10,power:5},


Axon_1_0minus0:{start_node:"Component1_0", end_node:"Output_0MINUS0", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_0minus0:{start_node:"Component2_0", end_node:"Output_0MINUS0", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_MINUS_0minus0:{start_node:"Operator_MINUS", end_node:"Output_0MINUS0", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_0minus0:{start_node:"Output_0MINUS0", end_node:"RESULT_0", shape:["default"], type:"glutamate", lengthsec:10,power:5},

Axon_1_0minus1:{start_node:"Component1_0", end_node:"Output_0MINUS1", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_0minus1:{start_node:"Component2_1", end_node:"Output_0MINUS1", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_MINUS_0minus1:{start_node:"Operator_MINUS", end_node:"Output_0MINUS1", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_0minus1:{start_node:"Output_0MINUS1", end_node:"RESULT_minus1", shape:["default"], type:"glutamate", lengthsec:10,power:5},

Axon_1_0minus2:{start_node:"Component1_0", end_node:"Output_0MINUS2", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_0minus2:{start_node:"Component2_2", end_node:"Output_0MINUS2", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_MINUS_0minus2:{start_node:"Operator_MINUS", end_node:"Output_0MINUS2", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_0minus2:{start_node:"Output_0MINUS2", end_node:"RESULT_minus2", shape:["default"], type:"glutamate", lengthsec:10,power:5},

Axon_1_0minus3:{start_node:"Component1_0", end_node:"Output_0MINUS3", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_0minus3:{start_node:"Component2_3", end_node:"Output_0MINUS3", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_MINUS_0minus3:{start_node:"Operator_MINUS", end_node:"Output_0MINUS3", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_0minus3:{start_node:"Output_0MINUS3", end_node:"RESULT_minus3", shape:["default"], type:"glutamate", lengthsec:10,power:5},


Axon_1_1minus0:{start_node:"Component1_1", end_node:"Output_1MINUS0", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_1minus0:{start_node:"Component2_0", end_node:"Output_1MINUS0", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_MINUS_1minus0:{start_node:"Operator_MINUS", end_node:"Output_1MINUS0", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_1minus0:{start_node:"Output_1MINUS0", end_node:"RESULT_1", shape:["default"], type:"glutamate", lengthsec:10,power:5},

Axon_1_1minus1:{start_node:"Component1_1", end_node:"Output_1MINUS1", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_1minus1:{start_node:"Component2_1", end_node:"Output_1MINUS1", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_MINUS_1minus1:{start_node:"Operator_MINUS", end_node:"Output_1MINUS1", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_1minus1:{start_node:"Output_1MINUS1", end_node:"RESULT_0", shape:["default"], type:"glutamate", lengthsec:10,power:5},

Axon_1_1minus2:{start_node:"Component1_1", end_node:"Output_1MINUS2", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_1minus2:{start_node:"Component2_2", end_node:"Output_1MINUS2", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_MINUS_1minus2:{start_node:"Operator_MINUS", end_node:"Output_1MINUS2", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_1minus2:{start_node:"Output_1MINUS2", end_node:"RESULT_minus1", shape:["default"], type:"glutamate", lengthsec:10,power:5},

Axon_1_1minus3:{start_node:"Component1_1", end_node:"Output_1MINUS3", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_1minus3:{start_node:"Component2_3", end_node:"Output_1MINUS3", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_MINUS_1minus3:{start_node:"Operator_MINUS", end_node:"Output_1MINUS3", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_1minus3:{start_node:"Output_1MINUS3", end_node:"RESULT_minus2", shape:["default"], type:"glutamate", lengthsec:10,power:5},


Axon_1_2minus0:{start_node:"Component1_2", end_node:"Output_2MINUS0", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_2minus0:{start_node:"Component2_0", end_node:"Output_2MINUS0", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_MINUS_2minus0:{start_node:"Operator_MINUS", end_node:"Output_2MINUS0", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2minus0:{start_node:"Output_2MINUS0", end_node:"RESULT_2", shape:["default"], type:"glutamate", lengthsec:10,power:5},

Axon_1_2minus1:{start_node:"Component1_2", end_node:"Output_2MINUS1", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_2minus1:{start_node:"Component2_1", end_node:"Output_2MINUS1", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_MINUS_2minus1:{start_node:"Operator_MINUS", end_node:"Output_2MINUS1", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2minus1:{start_node:"Output_2MINUS1", end_node:"RESULT_1", shape:["default"], type:"glutamate", lengthsec:10,power:5},

Axon_1_2minus2:{start_node:"Component1_2", end_node:"Output_2MINUS2", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_2minus2:{start_node:"Component2_2", end_node:"Output_2MINUS2", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_MINUS_2minus2:{start_node:"Operator_MINUS", end_node:"Output_2MINUS2", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2minus2:{start_node:"Output_2MINUS2", end_node:"RESULT_0", shape:["default"], type:"glutamate", lengthsec:10,power:5},

Axon_1_2minus3:{start_node:"Component1_2", end_node:"Output_2MINUS3", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_2minus3:{start_node:"Component2_3", end_node:"Output_2MINUS3", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_MINUS_2minus3:{start_node:"Operator_MINUS", end_node:"Output_2MINUS3", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2minus3:{start_node:"Output_2MINUS3", end_node:"RESULT_minus1", shape:["default"], type:"glutamate", lengthsec:10,power:5},





Axon_1_3minus0:{start_node:"Component1_3", end_node:"Output_3MINUS0", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_3minus0:{start_node:"Component2_0", end_node:"Output_3MINUS0", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_MINUS_3minus0:{start_node:"Operator_MINUS", end_node:"Output_3MINUS0", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_3minus0:{start_node:"Output_3MINUS0", end_node:"RESULT_3", shape:["default"], type:"glutamate", lengthsec:10,power:5},

Axon_1_3minus1:{start_node:"Component1_3", end_node:"Output_3MINUS1", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_3minus1:{start_node:"Component2_1", end_node:"Output_3MINUS1", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_MINUS_3minus1:{start_node:"Operator_MINUS", end_node:"Output_3MINUS1", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_3minus1:{start_node:"Output_3MINUS1", end_node:"RESULT_2", shape:["default"], type:"glutamate", lengthsec:10,power:5},

Axon_1_3minus2:{start_node:"Component1_3", end_node:"Output_3MINUS2", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_3minus2:{start_node:"Component2_2", end_node:"Output_3MINUS2", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_MINUS_3minus2:{start_node:"Operator_MINUS", end_node:"Output_3MINUS2", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_3minus2:{start_node:"Output_3MINUS2", end_node:"RESULT_1", shape:["default"], type:"glutamate", lengthsec:10,power:5},

Axon_1_3minus3:{start_node:"Component1_3", end_node:"Output_3MINUS3", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_2_3minus3:{start_node:"Component2_3", end_node:"Output_3MINUS3", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_MINUS_3minus3:{start_node:"Operator_MINUS", end_node:"Output_3MINUS3", shape:["default"], type:"glutamate", lengthsec:10,power:5},
Axon_3minus3:{start_node:"Output_3MINUS3", end_node:"RESULT_0", shape:["default"], type:"glutamate", lengthsec:10,power:5},




}



var NODES = {
Out:{type:"Y", outputs:[]},

Operator_PLUS:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN_shiftXY[0]+0,GREEN_shiftXY[1]+20]},
Operator_MINUS:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN_shiftXY[0]+0,GREEN_shiftXY[1]+980]},

Component1_0:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN_shiftXY[0]+0,GREEN_shiftXY[1]+420]},
Component1_1:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN_shiftXY[0]+0,GREEN_shiftXY[1]+440]},
Component1_2:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN_shiftXY[0]+0,GREEN_shiftXY[1]+460]},
Component1_3:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN_shiftXY[0]+0,GREEN_shiftXY[1]+480]},

Component2_0:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN_shiftXY[0]+0,GREEN_shiftXY[1]+500]},
Component2_1:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN_shiftXY[0]+0,GREEN_shiftXY[1]+520]},
Component2_2:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN_shiftXY[0]+0,GREEN_shiftXY[1]+540]},
Component2_3:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN_shiftXY[0]+0,GREEN_shiftXY[1]+560]},





Output_0PLUS0:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN2_shiftXY[0]+10,GREEN2_shiftXY[1]+20]},
Output_0PLUS1:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN2_shiftXY[0]+20,GREEN2_shiftXY[1]+40]},
Output_0PLUS2:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN2_shiftXY[0]+30,GREEN2_shiftXY[1]+60]},
Output_0PLUS3:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN2_shiftXY[0]+40,GREEN2_shiftXY[1]+80]},
Output_1PLUS0:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN2_shiftXY[0]+50,GREEN2_shiftXY[1]+120]},
Output_1PLUS1:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN2_shiftXY[0]+60,GREEN2_shiftXY[1]+140]},
Output_1PLUS2:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN2_shiftXY[0]+70,GREEN2_shiftXY[1]+160]},
Output_1PLUS3:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN2_shiftXY[0]+80,GREEN2_shiftXY[1]+180]},
Output_2PLUS0:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN2_shiftXY[0]+90,GREEN2_shiftXY[1]+220]},
Output_2PLUS1:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN2_shiftXY[0]+100,GREEN2_shiftXY[1]+240]},
Output_2PLUS2:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN2_shiftXY[0]+110,GREEN2_shiftXY[1]+260]},
Output_2PLUS3:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN2_shiftXY[0]+120,GREEN2_shiftXY[1]+280]},
Output_3PLUS0:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN2_shiftXY[0]+130,GREEN2_shiftXY[1]+320]},
Output_3PLUS1:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN2_shiftXY[0]+140,GREEN2_shiftXY[1]+340]},
Output_3PLUS2:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN2_shiftXY[0]+150,GREEN2_shiftXY[1]+360]},
Output_3PLUS3:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN2_shiftXY[0]+160,GREEN2_shiftXY[1]+380]},

Output_0MINUS0:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN3_shiftXY[0]+160,GREEN3_shiftXY[1]+20]},
Output_0MINUS1:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN3_shiftXY[0]+150,GREEN3_shiftXY[1]+40]},
Output_0MINUS2:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN3_shiftXY[0]+140,GREEN3_shiftXY[1]+60]},
Output_0MINUS3:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN3_shiftXY[0]+130,GREEN3_shiftXY[1]+80]},
Output_1MINUS0:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN3_shiftXY[0]+120,GREEN3_shiftXY[1]+120]},
Output_1MINUS1:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN3_shiftXY[0]+110,GREEN3_shiftXY[1]+140]},
Output_1MINUS2:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN3_shiftXY[0]+100,GREEN3_shiftXY[1]+160]},
Output_1MINUS3:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN3_shiftXY[0]+90,GREEN3_shiftXY[1]+180]},
Output_2MINUS0:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN3_shiftXY[0]+80,GREEN3_shiftXY[1]+220]},
Output_2MINUS1:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN3_shiftXY[0]+70,GREEN3_shiftXY[1]+240]},
Output_2MINUS2:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN3_shiftXY[0]+60,GREEN3_shiftXY[1]+260]},
Output_2MINUS3:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN3_shiftXY[0]+50,GREEN3_shiftXY[1]+280]},
Output_3MINUS0:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN3_shiftXY[0]+40,GREEN3_shiftXY[1]+320]},
Output_3MINUS1:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN3_shiftXY[0]+30,GREEN3_shiftXY[1]+340]},
Output_3MINUS2:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN3_shiftXY[0]+20,GREEN3_shiftXY[1]+360]},
Output_3MINUS3:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN3_shiftXY[0]+10,GREEN3_shiftXY[1]+380]},




RESULT_minus3:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN4_shiftXY[0]+200,GREEN4_shiftXY[1]+20]},
RESULT_minus2:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN4_shiftXY[0]+180,GREEN4_shiftXY[1]+40]},
RESULT_minus1:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN4_shiftXY[0]+160,GREEN4_shiftXY[1]+60]},
RESULT_0:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN4_shiftXY[0]+140,GREEN4_shiftXY[1]+80]},
RESULT_1:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN4_shiftXY[0]+120,GREEN4_shiftXY[1]+100]},
RESULT_2:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN4_shiftXY[0]+100,GREEN4_shiftXY[1]+120]},
RESULT_3:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN4_shiftXY[0]+80,GREEN4_shiftXY[1]+140]},
RESULT_4:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN4_shiftXY[0]+60,GREEN4_shiftXY[1]+160]},
RESULT_5:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN4_shiftXY[0]+40,GREEN4_shiftXY[1]+180]},
RESULT_6:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN4_shiftXY[0]+20,GREEN4_shiftXY[1]+200]},

/*

PRKJ_A_FL:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN_shiftXY[0]+CBCTX_shiftXY[0]+PRKJ_shiftXY[0],GREEN_shiftXY[1]+CBCTX_shiftXY[1]+PRKJ_shiftXY[1]]},

Stellate_A_FL:{type:"SOMA", soma_value:5, outputs:[],coordxy:[GREEN_shiftXY[0]+CBCTX_shiftXY[0]+Stellate_shiftXY[0],GREEN_shiftXY[1]+CBCTX_shiftXY[1]+Stellate_shiftXY[1]]},


Parallel_Fiber_spinal:{type:"SOMA", soma_value:5, outputs:[],coordxy:[Parallel_shiftXY[0]+0,Parallel_shiftXY[1]+0]},


Parallel_Fiber_Granule:{type:"Y", soma_value:5, outputs:[],coordxy:[Parallel_shiftXY[0]+0,Parallel_shiftXY[1]-20]},
*/


}

var currspike_id = 0 ; 
var MOVINGSPIKES = {} ; 
var startTime = 0;
var OnlyOnce = 0 ; 




var x = 100;
var y = 50;
var r = 10;
var duration = 1000; // in ms
var nextX, nextY;

function GetDistXYZ(currxyz1, currxyz2) {
    return Math.sqrt(((currxyz1[0]-currxyz2[0])*(currxyz1[0]-currxyz2[0]))+((currxyz1[1]-currxyz2[1])*(currxyz1[1]-currxyz2[1]))) ; 
}

function GetLayerPointAtLength(_CurrSomaLayer, _LengthAtLayer) {
///console.log("DDD8", _CurrSomaLayer, _LengthAtLayer)
    CurrLengthAtLayer = 0
    ret = [_LengthAtLayer, _LengthAtLayer]

            for (var i = 0 ; i< _CurrSomaLayer.length-1 ; i++) {
///console.log("DDD7", CurrLengthAtLayer)
                var currxyz1 = _CurrSomaLayer[i]
                var currxyz2 = _CurrSomaLayer[i+1]
                CurrCutDist = GetDistXYZ(currxyz1, currxyz2)




                if (CurrLengthAtLayer + CurrCutDist > _LengthAtLayer) {
_currproportion = (_LengthAtLayer - CurrLengthAtLayer)/CurrCutDist
ret = [currxyz1[0]+(_currproportion*(currxyz2[0]-currxyz1[0])), currxyz1[1]+(_currproportion*(currxyz2[1]-currxyz1[1]))] ; 
                    return ret ; /// currxyz1 ; 
                }
                CurrLengthAtLayer = CurrLengthAtLayer + CurrCutDist
            }

    return ret
}

function RedrawSpike(eachspike) {
_currxy = GetLayerPointAtLength(MOVINGSPIKES[eachspike].currentaxon.shape, MOVINGSPIKES[eachspike].curraxonlength*MOVINGSPIKES[eachspike].currentposonaxon/MOVINGSPIKES[eachspike].currentaxon.lengthsec)
circle(_currxy[0], _currxy[1], 5)
}



function GetFunctionColor(_func) {
    ret = "black"

if (_func in funccolors) {ret = funccolors[_func]}
    ///else {console.log(_func)
        ///console.log(a)}
return ret
}



function RedrawNode(eachnode,eachnode_name) {
///console.log(eachnode)

if (eachnode.type == "SOMA") {
circle(eachnode.coordxy[0], eachnode.coordxy[1], eachnode.soma_value)
textshiftx = 0
if (eachnode.functions) {
///console.log(eachnode.functions)
textshiftx = 10*eachnode.functions.length
for (var i = 0 ; i< eachnode.functions.length ; i++) {
    ctx.font = "25px Arial bold";
    ///ctx.color = "#ff0000" ;
    ctx.fillStyle = GetFunctionColor(eachnode.functions[i]) ; ///"#ff0000"; 
    ctx.fillText("*", i*10 + 2 + eachnode.coordxy[0], 10 + eachnode.coordxy[1]);
}
}
ctx.font = "10px Arial";
    ctx.fillStyle = "black"; 
ctx.fillText(eachnode_name, textshiftx + eachnode.coordxy[0], eachnode.coordxy[1]);
}} 


function RecalculateNode(eachnode) {
if (eachnode.type == "SOMA") {
if ((startTime/10 == Math.floor(startTime/10) && (OnlyOnce))) {
///console.log(startTime, eachnode.soma_value)
if (eachnode.soma_value > 5) {eachnode.soma_value = eachnode.soma_value - 1}
if (eachnode.soma_value < 5) {eachnode.soma_value = 1*eachnode.soma_value + 1}
OnlyOnce = 0 ; 
}}} 
 
function RecalculateSpike(eachspike) {
    ///console.log(MOVINGSPIKES[eachspike].currentposonaxon) ;
    MOVINGSPIKES[eachspike].currentposonaxon = MOVINGSPIKES[eachspike].currentposonaxon + 1 ; 
///console.log(MOVINGSPIKES[eachspike].currentaxon)
    if (MOVINGSPIKES[eachspike].currentposonaxon > MOVINGSPIKES[eachspike].currentaxon.lengthsec-1) {
        ///PassFinishNode() ;
///var NODES = {PurkinjeDendrite:{type:"Y", outputs:["Axon3"]}}
        curr_end_node = NODES[MOVINGSPIKES[eachspike].currentaxon.end_node]
        if (curr_end_node.type == "Y") {
            for (eachoutput in curr_end_node.outputs) {
///console.log(NODES[MOVINGSPIKES[eachspike].currentaxon.end_node])
                currspike_id = currspike_id + 1 ; 
                MOVINGSPIKES[currspike_id] = {currentaxon:AXONS[curr_end_node.outputs[eachoutput]], currentposonaxon:0, currentpower:1, curraxonlength:GetAxonLength(AXONS[curr_end_node.outputs[eachoutput]].shape)}
            }
        }

        if (curr_end_node.type == "SOMA") {
            NODES[MOVINGSPIKES[eachspike].currentaxon.end_node].soma_value = NODES[MOVINGSPIKES[eachspike].currentaxon.end_node].soma_value + MOVINGSPIKES[eachspike].currentaxon.power ; 
            if (NODES[MOVINGSPIKES[eachspike].currentaxon.end_node].soma_value > 15) {NODES[MOVINGSPIKES[eachspike].currentaxon.end_node].soma_value = 15}
            if (NODES[MOVINGSPIKES[eachspike].currentaxon.end_node].soma_value < 1) {NODES[MOVINGSPIKES[eachspike].currentaxon.end_node].soma_value = 1}
            if (NODES[MOVINGSPIKES[eachspike].currentaxon.end_node].soma_value > 10) {
                for (eachoutput in curr_end_node.outputs) {
console.log(NODES[MOVINGSPIKES[eachspike].currentaxon.end_node])
                    currspike_id = currspike_id + 1 ; 
                    MOVINGSPIKES[currspike_id] = {currentaxon:AXONS[curr_end_node.outputs[eachoutput]], currentposonaxon:0, currentpower:1, curraxonlength:GetAxonLength(AXONS[curr_end_node.outputs[eachoutput]].shape)}

                }
            NODES[MOVINGSPIKES[eachspike].currentaxon.end_node].soma_value = 5 ; 
            }

        }
        delete  MOVINGSPIKES[eachspike] ; 
    }
} 

function anim(time) {
///console.log(MOVINGSPIKES)
  //if (!startTime) // it's the first frame
   // startTime = time || performance.now();
startTime = startTime + 1 ; 
OnlyOnce = 1 ; 
clear() ; 
for (eachaxon in AXONS) {
    drawLine(AXONS[eachaxon])
}
for (eachspike in MOVINGSPIKES) {

RedrawSpike(eachspike) ; 
RecalculateSpike(eachspike) ; 

}

for (eachnode in NODES) {

RedrawNode(NODES[eachnode],eachnode) ; 
RecalculateNode(NODES[eachnode]) ; 

}


i_color = 0
for (eachcolor in funccolors) {
    i_color = i_color + 1 ; 
    ctx.fillStyle = funccolors[eachcolor];
circle(1900, i_color*20, 10)


    ctx.font = "15px Arial bold";
    ///ctx.color = "#ff0000" ;
    ///ctx.fillStyle = GetFunctionColor(eachnode.functions[i]) ; ///"#ff0000"; 
    ctx.fillText(eachcolor, 1920, i_color*20);


///ctx.beginPath();

///ctx.rect(1900, i_color*20, 20, 20);
///ctx.stroke();

}




  // deltaTime should be in the range [0 ~ 1]
  var deltaTime = (time - startTime) / duration;
  // currentPos = previous position + (difference * deltaTime)
  //var currentX = x + ((nextX - x) * deltaTime);
  //var currentY = y + ((nextY - y) * deltaTime);

 // if (deltaTime >= 1) { // this means we ended our animation
    x = nextX; // reset x variable
    y = nextY; // reset y variable
   // startTime = null; // reset startTime
   /// draw(x, y); // draw the last frame, at required position
 // } else {
   /// draw(currentX, currentY);
setTimeout(function() {
  //your code to be executed after 1 second
requestAnimationFrame(anim); // do it again
}, 500);
    
//  }
}
/*
MotorCortex.onclick = e => {
CreateSpike('AxonMF_1_1')
CreateSpike('AxonMF_1_2')
CreateSpike('AxonMF_1_3')
}
*/
// OP's code




function GetInputAxons(_inputtags) {
console.log(_inputtags)
foundtagnodes = {}
    for (eachnode in NODES) {
///console.log(NODES[eachnode].functions)
        for (eachinputtag in _inputtags) {
            for (eachfunction in NODES[eachnode].functions) {
                if (inputtags[eachinputtag] == NODES[eachnode].functions[eachfunction]) {
                    foundtagnodes[eachnode] = 1
///console.log(eachnode, eachinputtag, eachfunction)
                }
            }
        }
    }
console.log(foundtagnodes)
foundtagaxons = {}
    for (eachaxon in AXONS) {

        for (eachfoundtagnode in foundtagnodes) {
            if (eachfoundtagnode == AXONS[eachaxon].start_node) {
///console.log(eachaxon)    
                    foundtagaxons[eachaxon]     = 1 ; 
            }
        }
    }
console.log(foundtagaxons)
return foundtagaxons
}



Axon_OscPLUS.onclick = e => {CreateSpike('Axon_OscPLUS')}
Axon_OscMINUS.onclick = e => {CreateSpike('Axon_OscMINUS')}
Axon_Osc1_0.onclick = e => {CreateSpike('Axon_Osc1_0')}
Axon_Osc1_1.onclick = e => {CreateSpike('Axon_Osc1_1')}
Axon_Osc1_2.onclick = e => {CreateSpike('Axon_Osc1_2')}
Axon_Osc1_3.onclick = e => {CreateSpike('Axon_Osc1_3')}
Axon_Osc2_0.onclick = e => {CreateSpike('Axon_Osc2_0')}
Axon_Osc2_1.onclick = e => {CreateSpike('Axon_Osc2_1')}
Axon_Osc2_2.onclick = e => {CreateSpike('Axon_Osc2_2')}
Axon_Osc2_3.onclick = e => {CreateSpike('Axon_Osc2_3')}
/*

<input type="button" id="Axon_OscPLUS" value="PLUS" >
<input type="button" id="Axon_OscMINUS" value="MINUS" >
<input type="button" id="Axon_Osc1_0" value="Component1_0" >
<input type="button" id="Axon_Osc1_1" value="Component1_1" >
<input type="button" id="Axon_Osc1_2" value="Component1_2" >
<input type="button" id="Axon_Osc1_3" value="Component1_3" >
<input type="button" id="Axon_Osc2_0" value="Component2_0" >
<input type="button" id="Axon_Osc2_1" value="Component2_1" >
<input type="button" id="Axon_Osc2_2" value="Component2_2" >
<input type="button" id="Axon_Osc2_3" value="Component2_3" >





*/











var canvas = document.getElementById("canvas");
var ctx = canvas.getContext("2d");




/*
function draw(x, y) {
  clear(WIDTH, HEIGHT);
  ctx.fillStyle = "purple";
  circle(x, y, r);
}

draw(x, y);
*/

///////////////////////////////////////////////
function circle(x, y, r) {
  ctx.beginPath();
  ctx.arc(x, y, r, 0, Math.PI * 2, true);
  ctx.fill();
}
var WIDTH = 2200;
var HEIGHT = 1700;
function clear() {
  ctx.clearRect(0, 0, WIDTH, HEIGHT);
}



function GetAxonLength(_CurrSomaLayer) {
///console.log(_CurrSomaLayer)
    CurrLengthAtLayer = 0
            for (var i = 0 ; i< _CurrSomaLayer.length-1 ; i++) {
                var currxyz1 = _CurrSomaLayer[i]
                var currxyz2 = _CurrSomaLayer[i+1]
                CurrCutDist = GetDistXYZ(currxyz1, currxyz2)
                CurrLengthAtLayer = CurrLengthAtLayer + CurrCutDist
            }

    return CurrLengthAtLayer
}



function CreateSpike(_axon_id) {
console.log(_axon_id, AXONS[_axon_id])
currspike_id = currspike_id + 1 ; 
MOVINGSPIKES[currspike_id] = {currentaxon:AXONS[_axon_id], currentposonaxon:0, currentpower:1, curraxonlength:GetAxonLength(AXONS[_axon_id].shape)}
}



function drawLine(_shape) {
    ///console.log("AAA", NODES[_shape.start_node].coordxy, NODES[_shape.end_node].coordxy)
ctx.beginPath();
///ctx.moveTo(NODES[_shape.start_node].coordxy[0], NODES[_shape.start_node].coordxy[1]);
///console.log(_shape)
ctx.moveTo(_shape.shape[0][0], _shape.shape[0][1]);
_color = '#555555'
if (_shape.type == "GABA") {_color = '#ff0000'}
if (_shape.type == "glutamate") {_color = '#00ff00'}
if (_shape.type == "GABA_glycine") {_color = '#ff0099'}
for (i = 1; i < _shape.shape.length; i++) { 
ctx.lineTo(_shape.shape[i][0], _shape.shape[i][1]);
}
///ctx.lineTo(NODES[_shape.end_node].coordxy[0], NODES[_shape.end_node].coordxy[1]);
      ctx.lineWidth = Math.abs(_shape.power)+1;
      ctx.strokeStyle = _color;
ctx.stroke();


ctx.beginPath();
ctx.moveTo(_shape.arrow[0][0], _shape.arrow[0][1]);
ctx.lineTo(_shape.arrow[1][0], _shape.arrow[1][1]);
ctx.lineTo(_shape.arrow[2][0], _shape.arrow[2][1]);
      ctx.lineWidth = Math.abs(_shape.power)+1;
      ///console.log(ctx.lineWidth)
      ctx.strokeStyle = _color;
ctx.stroke();
}


//for (eachaxon in AXONS) {
//  drawLine(AXONS[eachaxon])
//}




function FillNodeOutputs() {
///TODO add arrows 
    for (each in AXONS) {
///console.log(NODES[AXONS[each].start_node].outputs, AXONS[each].end_node)
        NODES[AXONS[each].start_node].outputs.push(each) ; ///AXONS[each].end_node) ;

if (AXONS[each].shape[0] == "default") {

///console.log("gggggggggggggggggg",NODES[AXONS[each].start_node].coordxy,NODES[AXONS[each].end_node].coordxy)
    if (NODES[AXONS[each].start_node].coordxy[1] < NODES[AXONS[each].end_node].coordxy[1]) {

        _dx = 10
        if (NODES[AXONS[each].end_node].coordxy[0] < NODES[AXONS[each].start_node].coordxy[0]) {_dx = -10}

        AXONS[each].shape=[
[NODES[AXONS[each].end_node].coordxy[0]-_dx,NODES[AXONS[each].start_node].coordxy[1]],
[NODES[AXONS[each].end_node].coordxy[0],NODES[AXONS[each].start_node].coordxy[1]+10]
]
    } else {
        _dx = 10
        if (NODES[AXONS[each].end_node].coordxy[0] < NODES[AXONS[each].start_node].coordxy[0]) {_dx = -10}

        AXONS[each].shape=[
[NODES[AXONS[each].end_node].coordxy[0]-_dx,NODES[AXONS[each].start_node].coordxy[1]],
[NODES[AXONS[each].end_node].coordxy[0],NODES[AXONS[each].start_node].coordxy[1] - 10]
]


    }
///console.log("gggggggggggggggggg222",AXONS[each].shape)
}








if (AXONS[each].shape[0] == "loop") {

        AXONS[each].shape=[
[NODES[AXONS[each].end_node].coordxy[0] + 10,NODES[AXONS[each].start_node].coordxy[1] - 10],
[NODES[AXONS[each].end_node].coordxy[0] + 10,NODES[AXONS[each].start_node].coordxy[1] - 30],
[NODES[AXONS[each].end_node].coordxy[0] + 0,NODES[AXONS[each].start_node].coordxy[1] - 40],
[NODES[AXONS[each].end_node].coordxy[0] - 10,NODES[AXONS[each].start_node].coordxy[1] - 30],
[NODES[AXONS[each].end_node].coordxy[0] - 10,NODES[AXONS[each].start_node].coordxy[1] - 10],
]

}








        AXONS[each].shape.unshift(NODES[AXONS[each].start_node].coordxy)
        AXONS[each].shape.push(NODES[AXONS[each].end_node].coordxy)

///console.log("gggggggg3333333333333333",AXONS[each].shape)


arrow1 = AXONS[each].shape[AXONS[each].shape.length-1]
_r = 10
arrowangle = Math.atan2(AXONS[each].shape[AXONS[each].shape.length-1][0]-AXONS[each].shape[AXONS[each].shape.length-2][0], AXONS[each].shape[AXONS[each].shape.length-1][1] - AXONS[each].shape[AXONS[each].shape.length-2][1])
///console.log(arrowangle)

arrow0 = [arrow1[0]-_r*Math.sin(arrowangle-0.2), arrow1[1]-_r*Math.cos(arrowangle-0.2)] 

arrow2 = [arrow1[0]-_r*Math.sin(arrowangle+0.2), arrow1[1]-_r*Math.cos(arrowangle+0.2)] 

        AXONS[each].arrow=[arrow0,arrow1,arrow2]
    }
console.log(AXONS)
}





FillNodeOutputs();
  anim();

</script>
<style>
#canvas {
  border: 1px solid black;
}
</style>